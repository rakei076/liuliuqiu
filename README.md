# 在日华人生活助手（微信公众号 AI 对话）— 入门与计划 v0.2

这份文档面向新手，目标是“先在公众号里跑通一个能回复的 AI”。

你会得到：

- 一个轻量 Webhook（你的服务器上运行），5 秒内回占位消息；
- 一个腾讯云 SCF 云函数，调用 DeepSeek 生成答案；
- 云函数再通过“客服消息接口”把 AI 的答案发回用户。

如果你想直接操作，请打开 README_Deploy.md，按步骤一步步来。

---

## 1. 我们要达成什么

- 用户在你的公众号里发消息（文本），马上收到“我在思考啦，请稍等～”（被动回复，占位）。
- 1–5 秒后，再收到 AI 生成的答案（客服消息）。

---

## 2. 核心共识（当前版本）

- 加解密模式：开发期“明文模式”（调试简单）。
- 异步策略：A 方案（先回占位，再发客服消息）。
- 模型：DeepSeek（deepseek-chat，OpenAI 兼容接口 /v1/chat/completions）。
- 计算：放在腾讯云函数 SCF 上执行。
- 数据库与知识库：下一阶段再加（本期先跑通 AI 文本对话）。

---

## 3. 简化架构（文字图）

用户 → 公众号 → 你的 Webhook（小服务器）

- Webhook：5 秒内返回占位文本：“我在思考啦，请稍等～”
- 同时把任务（openid、文本）POST 给腾讯云 SCF（API 网关触发）

SCF → 调用 DeepSeek 生成答案 → 用“客服消息接口”发回 AI 文本给用户

---

## 4. 你需要准备

- 公众号（测试号或正式号）
- 小型服务器（公网可访问，HTTP）
- 腾讯云账号（SCF + API 网关）
- DeepSeek API Key

切记：所有密钥只放在环境变量或云端密钥管理，不要写进代码。

---

## 5. 新手词汇速懂

- Webhook：微信把用户消息 POST 到你设定的接口地址（你的服务器接收）。
- 被动回复：5 秒内返回 XML 文本（占位用）。
- 客服消息：在 48 小时内，你可以主动再发消息给用户（用来发 AI 结果）。
- Access Token：公众号接口的“通行证”，2 小时过期，需要自动刷新。
- SCF：腾讯云函数（代码放云上执行，不用管机器）。
- DeepSeek：大语言模型（负责生成答案）。
- 明文模式：消息是明文（好调试），上线可切换“安全模式（AES）”。

---

## 6. 部署快速索引

- 详细步骤见：README_Deploy.md
- 关键文件：
    - server/app.py（Webhook）
    - server/wechat_utils.py（签名、XML、Token工具）
    - scf/index.py（SCF 主体：调用 DeepSeek + 回发客服消息）
    - scf/requirements.txt（云函数依赖）
    - .env.sample（环境变量样例）

---

## 7. 验收标准（你可以用来自测）

- 在公众号里发“你好/东京中餐推荐”
    - 立即收到占位回复
    - 1–5 秒内收到 AI 客服消息
- 并发 10 人测试：10 秒内均能拿到 AI 回复
- Access Token 过期可自动恢复
- DeepSeek 超时或失败，有兜底提示（例如“我现在有点忙，请稍后再试～”）

---

## 8. 下一阶段（预告）

- 加入数据库：结构化数据直接查询并模板化输出；文档类用检索增强（RAG）。
- 加入会话记忆（最近 N 轮）与更丰富的提示工程。
- 监控与告警：错误率、响应时延、配额告警。

---

## 9. 变更记录

- v0.2（当前）
    - 首次交付可运行的最小可行版本：Webhook + SCF + DeepSeek
    - 新增部署指南 README_Deploy.md
    - 代码：server/ 与 scf/ 目录初始化
    